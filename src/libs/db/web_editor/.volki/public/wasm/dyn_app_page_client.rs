#![no_std] #![no_main] #[panic_handler] fn panic(_: &core::panic::PanicInfo) -> ! { loop {} } static mut HEAP: [u8; 65536] = [0u8; 65536]; static mut HEAP_PTR: usize = 0; #[unsafe(no_mangle)] pub extern "C" fn __volki_alloc(size: i32) -> i32 { unsafe { let ptr = core::ptr::addr_of!(HEAP_PTR).read(); let new_ptr = ptr + size as usize; if new_ptr > 65536 { return 0; } core::ptr::addr_of_mut!(HEAP_PTR).write(new_ptr); core::ptr::addr_of_mut!(HEAP).cast::<u8>().add(ptr) as i32 } } #[unsafe(no_mangle)] pub extern "C" fn __volki_dealloc() { unsafe { core::ptr::addr_of_mut!(HEAP_PTR).write(0); } } unsafe extern "C" { fn __volki_component_begin(id: i32); fn __volki_component_end(); fn __volki_state_init_i32(slot: i32, initial: i32) -> i32; fn __volki_xstate_get_i32(comp_id: i32, slot: i32) -> i32; fn __volki_xstate_set_i32(comp_id: i32, slot: i32, value: i32); fn __volki_state_fmt_i32(value: i32, buf_ptr: i32, buf_len: i32) -> i32; fn __volki_dom_query(sel_ptr: i32, sel_len: i32) -> i32; fn __volki_dom_set_text(handle: i32, text_ptr: i32, text_len: i32); fn __volki_dom_get_value(handle: i32) -> i32; fn __volki_dom_get_value_len(handle: i32) -> i32; fn __volki_dom_add_class(handle: i32, cls_ptr: i32, cls_len: i32); fn __volki_dom_remove_class(handle: i32, cls_ptr: i32, cls_len: i32); fn __volki_console_log(msg_ptr: i32, msg_len: i32); fn __volki_console_log_i32(value: i32); } fn __volki_log_str(msg: &str) { unsafe { __volki_console_log(msg.as_ptr() as i32, msg.len() as i32); } } fn __volki_log_i32(val: i32) { unsafe { __volki_console_log_i32(val); } } fn get_delete_dialog_visible() -> i32 { unsafe { __volki_xstate_get_i32(0, 0) } } fn set_delete_dialog_visible(value: i32) { unsafe { __volki_xstate_set_i32(0, 0, value); } } fn get_status_mode() -> i32 { unsafe { __volki_xstate_get_i32(1, 0) } } fn set_status_mode(value: i32) { unsafe { __volki_xstate_set_i32(1, 0, value); } } fn get_inserting() -> i32 { unsafe { __volki_xstate_get_i32(2, 0) } } fn set_inserting(value: i32) { unsafe { __volki_xstate_set_i32(2, 0, value); } } fn get_counter_count() -> i32 { unsafe { __volki_xstate_get_i32(3, 0) } } fn set_counter_count(value: i32) { unsafe { __volki_xstate_set_i32(3, 0, value); } } #[unsafe(no_mangle)] pub extern "C" fn __volki_component_delete_dialog() { unsafe { __volki_component_begin(0); let delete_dialog_visible = __volki_state_init_i32(0, 0); let set_delete_dialog_visible = |value: i32| { __volki_xstate_set_i32(0, 0, value); }; let __q = "#delete-dialog"; let overlay = __volki_dom_query(__q.as_ptr() as i32, __q.len() as i32); if delete_dialog_visible == 1 { let __s0 = "hidden"; __volki_dom_remove_class(overlay, __s0.as_ptr() as i32, __s0.len() as i32); } else { let __s1 = "hidden"; __volki_dom_add_class(overlay, __s1.as_ptr() as i32, __s1.len() as i32); } let _ = set_delete_dialog_visible; __volki_component_end(); } } #[unsafe(no_mangle)] pub extern "C" fn __volki_component_status_display() { unsafe { __volki_component_begin(1); let status_mode = __volki_state_init_i32(0, 0); let set_status_mode = |value: i32| { __volki_xstate_set_i32(1, 0, value); }; let __q = "#conn-status"; let status = __volki_dom_query(__q.as_ptr() as i32, __q.len() as i32); let __q = "#status-dot"; let dot = __volki_dom_query(__q.as_ptr() as i32, __q.len() as i32); if status_mode == 0 { let __s0 = "Connected to PostgreSQL 16.2"; __volki_dom_set_text(status, __s0.as_ptr() as i32, __s0.len() as i32); let __s1 = "bg-yellow-500"; __volki_dom_remove_class(dot, __s1.as_ptr() as i32, __s1.len() as i32); let __s2 = "bg-green-500"; __volki_dom_add_class(dot, __s2.as_ptr() as i32, __s2.len() as i32); } else if status_mode == 1 { let __s3 = "Deleting..."; __volki_dom_set_text(status, __s3.as_ptr() as i32, __s3.len() as i32); let __s4 = "bg-green-500"; __volki_dom_remove_class(dot, __s4.as_ptr() as i32, __s4.len() as i32); let __s5 = "bg-yellow-500"; __volki_dom_add_class(dot, __s5.as_ptr() as i32, __s5.len() as i32); } else { let __s6 = "Connected to PostgreSQL 16.2"; __volki_dom_set_text(status, __s6.as_ptr() as i32, __s6.len() as i32); let __s7 = "bg-yellow-500"; __volki_dom_remove_class(dot, __s7.as_ptr() as i32, __s7.len() as i32); let __s8 = "bg-green-500"; __volki_dom_add_class(dot, __s8.as_ptr() as i32, __s8.len() as i32); } let _ = set_status_mode; __volki_component_end(); } } #[unsafe(no_mangle)] pub extern "C" fn __volki_component_insert_button() { unsafe { __volki_component_begin(2); let inserting = __volki_state_init_i32(0, 0); let set_inserting = |value: i32| { __volki_xstate_set_i32(2, 0, value); }; let __q = "#btn-insert"; let btn = __volki_dom_query(__q.as_ptr() as i32, __q.len() as i32); if inserting == 1 { let __s0 = "opacity-70"; __volki_dom_add_class(btn, __s0.as_ptr() as i32, __s0.len() as i32); } else { let __s1 = "opacity-70"; __volki_dom_remove_class(btn, __s1.as_ptr() as i32, __s1.len() as i32); } let _ = set_inserting; __volki_component_end(); } } #[unsafe(no_mangle)] pub extern "C" fn __volki_component_counter() { unsafe { __volki_component_begin(3); let counter_count = __volki_state_init_i32(0, 0); let set_counter_count = |value: i32| { __volki_xstate_set_i32(3, 0, value); }; let __q = "#counter-value"; let el = __volki_dom_query(__q.as_ptr() as i32, __q.len() as i32); let __fb0 = __volki_alloc(20); let __fl0 = __volki_state_fmt_i32(counter_count, __fb0, 20); __volki_dom_set_text(el, __fb0, __fl0); let _ = set_counter_count; __volki_component_end(); } } #[unsafe(no_mangle)] pub extern "C" fn filter_rows() { unsafe { let __q = "#filter-input"; let input = __volki_dom_query(__q.as_ptr() as i32, __q.len() as i32); let __gvptr = __volki_dom_get_value(input); let __gvlen = __volki_dom_get_value_len(input); let term = core::str::from_utf8_unchecked(core::slice::from_raw_parts(__gvptr as *const u8, __gvlen as usize)); __volki_log_str(term); } } #[unsafe(no_mangle)] pub extern "C" fn toggle_select_all(checked: i32) { unsafe { let __l0 = "select-all toggled"; __volki_log_str(__l0); } } #[unsafe(no_mangle)] pub extern "C" fn delete_selected() { unsafe { set_delete_dialog_visible(1); } } #[unsafe(no_mangle)] pub extern "C" fn cancel_delete() { unsafe { set_delete_dialog_visible(0); } } #[unsafe(no_mangle)] pub extern "C" fn confirm_delete() { unsafe { set_delete_dialog_visible(0); set_status_mode(1); let __l0 = "delete confirmed"; __volki_log_str(__l0); } } #[unsafe(no_mangle)] pub extern "C" fn insert_row() { unsafe { set_inserting(1); let __l0 = "insert-row clicked"; __volki_log_str(__l0); } } #[unsafe(no_mangle)] pub extern "C" fn on_increment() { unsafe { let counter_count = get_counter_count(); set_counter_count(counter_count + 1); } } #[unsafe(no_mangle)] pub extern "C" fn on_decrement() { unsafe { let counter_count = get_counter_count(); __volki_log_i32(counter_count); set_counter_count(counter_count - 1); } }